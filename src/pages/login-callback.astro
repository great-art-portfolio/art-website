---
const state = Astro.params.state
const code = Astro.params.code
---
<script>
  // /login -> github login -> /admin-oauth -> /login-callback -> /admin (with token)
  const urlParams = new URLSearchParams(window.location.search);
  const state = urlParams.get("state");
  const code = urlParams.get("code");
  const storedState = sessionStorage.getItem("GITHUB_APP_AUTH_HASH");

  if (state !== storedState) {
    console.error("State mismatch - possible CSRF");
    window.location.href = "/login"; // Or handle error
  } else {
    // State matches, proceed with code (POST to /admin-oauth later)
    console.log("State validated, code:", code);
  }
</script>
